<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation | json-database-st</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&family=Inter:wght@400;600&family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #050505; color: #d4d4d4; }
        h1, h2, h3 { font-family: 'Space Grotesk', sans-serif; color: white; }
        
        /* Clean Code Blocks */
        pre { border-radius: 8px; border: 1px solid rgba(255,255,255,0.08) !important; background: #0a0a0a !important; padding: 1.5rem !important; }
        
        /* Sidebar */
        .sidebar-link { display: block; padding: 6px 0; color: #737373; transition: all 0.2s; border-left: 2px solid transparent; padding-left: 1rem; font-size: 0.9rem; }
        .sidebar-link:hover { color: #e5e5e5; border-left-color: #525252; }
        .sidebar-link.active { color: #fbbf24; border-left-color: #fbbf24; font-weight: 500; }
        
        /* Typography */
        .api-method { font-family: 'Fira Code', monospace; color: #fbbf24; font-size: 1.1rem; }
        .badge { padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge-new { background: rgba(234, 179, 8, 0.2); color: #eab308; }
    </style>
</head>
<body class="flex flex-col md:flex-row min-h-screen">

    <!-- Left Sidebar -->
    <aside class="w-full md:w-72 bg-black border-r border-white/5 p-8 md:fixed md:h-screen overflow-y-auto z-20 scrollbar-hide">
        <div class="mb-10">
            <a href="index.html" class="text-lg font-bold text-white tracking-tight hover:text-yellow-500 transition">
                &larr; Back to Home
            </a>
        </div>
        <nav class="space-y-1">
            <p class="text-xs font-bold text-white uppercase tracking-widest mb-3 mt-6 opacity-40">Introduction</p>
            <a href="#install" class="sidebar-link">Installation</a>
            <a href="#init" class="sidebar-link">Initialization</a>
            
            <p class="text-xs font-bold text-white uppercase tracking-widest mb-3 mt-6 opacity-40">Core API</p>
            <a href="#basic" class="sidebar-link">get / set / has</a>
            <a href="#delete" class="sidebar-link">delete</a>
            <a href="#arrays" class="sidebar-link">push / pull</a>
            <a href="#math" class="sidebar-link">add / subtract <span class="badge badge-new">v2</span></a>
            
            <p class="text-xs font-bold text-white uppercase tracking-widest mb-3 mt-6 opacity-40">Querying</p>
            <a href="#find" class="sidebar-link">find</a>
            <a href="#indices" class="sidebar-link">findByIndex (Fast)</a>
            <a href="#pagination" class="sidebar-link">paginate <span class="badge badge-new">v2</span></a>
            
            <p class="text-xs font-bold text-white uppercase tracking-widest mb-3 mt-6 opacity-40">Advanced</p>
            <a href="#middleware" class="sidebar-link">Middleware Hooks</a>
            <a href="#schema" class="sidebar-link">Schema Validation</a>
            <a href="#events" class="sidebar-link">Events</a>
            <a href="#snapshots" class="sidebar-link">Snapshots</a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 md:ml-72 p-8 md:p-20 max-w-5xl">
        
        <div class="mb-16">
            <h1 class="text-5xl font-bold mb-6">Documentation</h1>
            <p class="text-lg text-gray-500 leading-relaxed">
                Complete reference for `json-database-st`. <br>
                Everything you need to store data safely in Node.js.
            </p>
        </div>

        <!-- Installation -->
        <section id="install" class="mb-20">
            <h2 class="text-3xl font-bold mb-6 text-white">Installation</h2>
            <div class="bg-[#0a0a0a] border border-white/10 rounded-lg p-4 flex items-center justify-between">
                <code class="text-yellow-500 font-mono">npm install json-database-st lodash proper-lockfile</code>
            </div>
        </section>

        <!-- Init -->
        <section id="init" class="mb-20">
            <h2 class="text-3xl font-bold mb-6 text-white">Initialization</h2>
            <pre><code class="language-javascript">const JSONDatabase = require('json-database-st');
const path = require('path');

const db = new JSONDatabase(path.join(__dirname, 'db.json'), {
    // Optional Configuration
    encryptionKey: process.env.KEY, // 32-byte hex string
    prettyPrint: true,              // Format JSON for readability
    saveDelay: 50,                  // Debounce writes (ms)
    indices: [                      // Speed up lookups
        { name: 'email', path: 'users', field: 'email' }
    ]
});</code></pre>
        </section>

        <!-- Basic Ops -->
        <section id="basic" class="mb-20">
            <h2 class="text-3xl font-bold mb-8 text-white">Basic Operations</h2>
            
            <div class="mb-10">
                <h3 class="api-method mb-2">set(path, value)</h3>
                <p class="text-gray-400 mb-3">Writes data to the path. Creates nested objects if they don't exist.</p>
                <pre><code class="language-javascript">await db.set('app.name', 'My App');
await db.set('users.1', { name: 'John', age: 25 });</code></pre>
            </div>

            <div class="mb-10">
                <h3 class="api-method mb-2">get(path, defaultValue)</h3>
                <p class="text-gray-400 mb-3">Retrieves data. Returns `defaultValue` if the path is missing.</p>
                <pre><code class="language-javascript">const name = await db.get('users.1.name');
const role = await db.get('users.1.role', 'guest'); // default to guest</code></pre>
            </div>

            <div class="mb-10">
                <h3 class="api-method mb-2">has(path)</h3>
                <p class="text-gray-400 mb-3">Checks if a key exists in the database.</p>
                <pre><code class="language-javascript">if (await db.has('users.1')) {
    console.log('User exists!');
}</code></pre>
            </div>
        </section>

        <!-- Delete -->
        <section id="delete" class="mb-20">
            <h2 class="text-3xl font-bold mb-6 text-white">Deletion</h2>
            <h3 class="api-method mb-2">delete(path)</h3>
            <p class="text-gray-400 mb-3">Removes a key or object from the database permanently.</p>
            <pre><code class="language-javascript">// Remove a specific field
await db.delete('users.1.age');

// Remove an entire object
await db.delete('users.1');</code></pre>
        </section>

        <!-- Arrays -->
        <section id="arrays" class="mb-20">
            <h2 class="text-3xl font-bold mb-8 text-white">Array Methods</h2>
            
            <div class="mb-10">
                <h3 class="api-method mb-2">push(path, ...items)</h3>
                <p class="text-gray-400 mb-3">Adds items to an array. <strong>Deeply checks for duplicates</strong> before adding.</p>
                <pre><code class="language-javascript">await db.push('admins', 'user1', 'user2');
// Won't add 'user1' again if it exists</code></pre>
            </div>

            <div class="mb-10">
                <h3 class="api-method mb-2">pull(path, ...items)</h3>
                <p class="text-gray-400 mb-3">Removes items from an array using deep comparison.</p>
                <pre><code class="language-javascript">await db.pull('admins', 'user2');</code></pre>
            </div>
        </section>

        <!-- Math -->
        <section id="math" class="mb-20">
            <h2 class="text-3xl font-bold mb-8 text-white">Atomic Math</h2>
            <p class="text-gray-400 mb-4">Atomic calculations. Safer than read-modify-write loops.</p>
            
            <pre><code class="language-javascript">await db.set('visits', 100);

// Atomic Increment
await db.add('visits', 1);

// Atomic Decrement
await db.subtract('visits', 10);</code></pre>
        </section>

        <!-- Find -->
        <section id="find" class="mb-20">
            <h2 class="text-3xl font-bold mb-6 text-white">Find (Scan)</h2>
            <h3 class="api-method mb-2">find(path, predicate)</h3>
            <p class="text-gray-400 mb-3">Scans an array or object to find a matching element. Uses Lodash syntax.</p>
            <pre><code class="language-javascript">// Find user where age is 25
const user = await db.find('users', { age: 25 });

// Find using a function
const active = await db.find('users', u => u.isActive === true);</code></pre>
        </section>

        <!-- Indices -->
        <section id="indices" class="mb-20">
            <h2 class="text-3xl font-bold mb-6 text-white">Find By Index (O1)</h2>
            <p class="text-gray-400 mb-4">For large datasets, use this instead of `find`. It uses a Hash Map for instant results.</p>
            <pre><code class="language-javascript">// 1. Setup
const db = new JSONDatabase('db.json', {
    indices: [{ name: 'user_email', path: 'users', field: 'email' }]
});

// 2. Fast Lookup
const user = await db.findByIndex('user_email', 'john@example.com');</code></pre>
        </section>

        <!-- Pagination -->
        <section id="pagination" class="mb-20">
            <h2 class="text-3xl font-bold mb-6 text-white">Pagination <span class="badge badge-new">v2</span></h2>
            <p class="text-gray-400 mb-4">Retrieve data in chunks. Essential for large lists or API endpoints.</p>
            <pre><code class="language-javascript">// Fetch Page 1 (10 items per page)
const result = await db.paginate('users', 1, 10);

console.log(result.data); // Array of users
console.log(result.meta); 
/* 
{ 
  total: 50, 
  page: 1, 
  limit: 10, 
  totalPages: 5, 
  hasNext: true 
} 
*/</code></pre>
        </section>

        <!-- Middleware -->
        <section id="middleware" class="mb-20">
            <h2 class="text-3xl font-bold mb-6 text-white">Middleware Hooks</h2>
            <p class="text-gray-400 mb-4">Intercept operations. Supported hooks: `before`, `after`. Supported methods: `set`, `delete`, `push`, `pull`.</p>
            <pre><code class="language-javascript">// Add timestamp before saving any user
db.before('set', 'users.*', (context) => {
    context.value.updatedAt = Date.now();
    return context; // Must return context
});</code></pre>
        </section>

        <!-- Schema -->
        <section id="schema" class="mb-20">
            <h2 class="text-3xl font-bold mb-6 text-white">Schema Validation</h2>
            <pre><code class="language-javascript">const { z } = require('zod');

const db = new JSONDatabase('db.json', { 
    schema: z.object({
        // your zod schema here
    }) 
});</code></pre>
        </section>

        <!-- Events -->
        <section id="events" class="mb-20">
            <h2 class="text-3xl font-bold mb-6 text-white">Events</h2>
            <p class="text-gray-400 mb-4">The database extends NodeJS EventEmitter.</p>
            <pre><code class="language-javascript">db.on('ready', () => console.log('Database loaded!'));

db.on('change', (data) => {
    console.log('Data changed:', data);
});

db.on('write', () => console.log('Data saved to disk.'));</code></pre>
        </section>

        <!-- Snapshots -->
        <section id="snapshots" class="mb-24">
            <h2 class="text-3xl font-bold mb-6 text-white">Backups (Snapshots)</h2>
            <p class="text-gray-400 mb-4">Create a manual copy of the database file instantly.</p>
            <pre><code class="language-javascript">const path = await db.createSnapshot('daily-backup');
console.log(`Backup saved to: ${path}`);</code></pre>
        </section>

        <footer class="border-t border-white/10 pt-12 text-gray-500 text-sm">
            <p>&copy; 2025 json-database-st. MIT License.</p>
        </footer>

    </main>

    <!-- Table of Contents (Right) -->
    <aside class="hidden xl:block w-64 p-8 fixed right-0 top-0 h-screen overflow-y-auto border-l border-white/5">
        <h5 class="text-xs font-bold text-white uppercase tracking-widest mb-4 mt-6 opacity-40">Contents</h5>
        <ul class="space-y-2 text-xs text-gray-500">
            <li><a href="#basic" class="hover:text-yellow-500 transition">Basic Operations</a></li>
            <li><a href="#delete" class="hover:text-yellow-500 transition">Deletion</a></li>
            <li><a href="#arrays" class="hover:text-yellow-500 transition">Array Methods</a></li>
            <li><a href="#math" class="hover:text-yellow-500 transition">Math Helpers</a></li>
            <li><a href="#find" class="hover:text-yellow-500 transition">Find / Search</a></li>
            <li><a href="#indices" class="hover:text-yellow-500 transition">Indexing</a></li>
            <li><a href="#pagination" class="hover:text-yellow-500 transition">Pagination</a></li>
            <li><a href="#events" class="hover:text-yellow-500 transition">Events</a></li>
            <li><a href="#snapshots" class="hover:text-yellow-500 transition">Backups</a></li>
        </ul>

        <div class="mt-12 p-4 bg-white/5 rounded border border-white/10">
            <p class="text-white font-bold text-xs mb-1">Maintained by</p>
            <a href="https://instagram.com/sethunthunder" class="text-yellow-500 text-xs hover:underline">@sethunthunder</a>
        </div>
    </aside>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
</body>
</html>