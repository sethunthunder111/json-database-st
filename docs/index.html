<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON-Database-ST | Secure, Simple, Fast JSON Database</title>
    <meta name="description" content="Complete documentation for JSON-Database-ST, a secure, promise-based, zero-dependency JSON file database for Node.js with indexing, schema validation, and encryption.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Fira+Code&display=swap" rel="stylesheet">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />

    <style>
        :root {
            --bg-color: #0f172a; /* Slate 900 */
            --card-bg: #1e293b;  /* Slate 800 */
            --border-color: #334155; /* Slate 700 */
            --text-color: #cbd5e1; /* Slate 300 */
            --heading-color: #f1f5f9; /* Slate 100 */
            --primary-color: #38bdf8; /* Sky 400 */
            --green-color: #4ade80; /* Green 400 */
        }
        
        *, *::before, *::after { box-sizing: border-box; }
        body {
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
            line-height: 1.7;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        h1, h2, h3, h4, h5, h6 {
            color: var(--heading-color);
            line-height: 1.3;
            margin-top: 2em;
            margin-bottom: 0.8em;
        }
        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.3em; }
        h3 { font-size: 1.5rem; }
        h4 { font-size: 1.2rem; color: var(--primary-color); }
        a { color: var(--primary-color); text-decoration: none; }
        a:hover { text-decoration: underline; }
        
        .container { max-width: 900px; margin: 0 auto; padding: 2rem 1rem; }
        .header { text-align: center; padding-bottom: 3rem; }
        .header h1 {
            background: linear-gradient(45deg, var(--primary-color), var(--green-color));
            -webkit-background-clip: text; background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 3.5rem; margin-bottom: 0.2em;
        }
        .header p { font-size: 1.2rem; color: var(--text-color); }
        
        code[class*="language-"], pre[class*="language-"] { font-family: 'Fira Code', monospace; font-size: 0.95em; }
        pre[class*="language-"] {
            background-color: #020617; border: 1px solid var(--border-color);
            border-radius: 8px; padding: 1.5rem; margin: 1em 0;
        }
        :not(pre) > code[class*="language-"] { background-color: var(--card-bg); padding: 0.1em 0.3em; border-radius: 4px; }
        
        .features {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem; list-style: none; padding: 0; margin-top: 2rem;
        }
        .feature-item { background-color: var(--card-bg); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border-color); }
        .feature-item h3 { margin-top: 0; font-size: 1.2rem; }
        
        .api-method {
            background-color: var(--card-bg); border: 1px solid var(--border-color);
            border-radius: 8px; margin-bottom: 2rem; overflow: hidden;
        }
        .api-header { padding: 1.2rem 1.5rem; background-color: rgba(255, 255, 255, 0.05); }
        .api-header h4 { margin: 0; font-family: 'Fira Code', monospace; font-size: 1.1rem; }
        .api-body { padding: 1rem 1.5rem 1.5rem 1.5rem; }
        .api-body p { margin-top: 0; }
        .api-body h5 { margin-top: 1.5rem; font-size: 1rem; }
        .params-list { list-style: none; padding-left: 1rem; margin-top: 1rem; }
        .params-list li { margin-bottom: 0.5em; }
        .param-name { font-weight: bold; color: var(--heading-color); font-family: 'Fira Code', monospace; }
        .param-type { color: var(--primary-color); font-style: italic; }

        .footer { text-align: center; margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border-color); color: #64748b; }

        @media (max-width: 600px) {
            h1 { font-size: 2rem; } .header h1 { font-size: 2.5rem; } .header p { font-size: 1rem; }
            .container { padding: 1rem 0.5rem; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <h1>JSON-Database-ST</h1>
            <p>A Secure, Simple, and Fast JSON File Database for Node.js</p>
        </header>

        <main>
            <!-- Sections: Introduction, Features, Installation, Quick Start -->
            <section id="introduction">
                <h2>What is it?</h2>
                <p>JSON-Database-ST is a lightweight, promise-based database that uses a single JSON file for storage. It's designed for projects that need simple, persistent data storage without the overhead of a traditional database server. With a focus on security, performance, and developer experience, it includes features like atomic operations, data indexing, schema validation, and built-in encryption.</p>
            </section>
            <section id="features">
                <h2>Key Features</h2>
                <ul class="features">
                    <li class="feature-item"><h3>üîí Secure by Default</h3><p>Built-in AES-256-GCM encryption at rest and path traversal protection to keep your data safe.</p></li>
                    <li class="feature-item"><h3>‚ö° Fast Indexed Lookups</h3><p>Create indexes on your data to retrieve records instantly (O(1)) instead of slow scanning.</p></li>
                    <li class="feature-item"><h3>ü§ù Atomic Operations</h3><p>All writes (set, push, batch, transaction) are atomic, ensuring data integrity even during concurrent operations.</p></li>
                     <li class="feature-item"><h3>‚úÖ Schema Validation</h3><p>Integrate with validation libraries like Zod or Joi to enforce data structures and prevent bad data.</p></li>
                    <li class="feature-item"><h3>üïäÔ∏è Modern Promise-Based API</h3><p>A clean, async/await-friendly API that is intuitive and easy to use.</p></li>
                    <li class="feature-item"><h3>üì¢ Event-Driven</h3><p>Emits events for 'write', 'change', and 'error', allowing for reactive programming and auditing.</p></li>
                </ul>
            </section>
            <section id="installation">
                <h2>Installation</h2>
                <pre><code class="language-bash"># Required peer dependency
npm install lodash

npm install json-database-st
</code></pre>
            </section>
            <section id="quick-start">
                <h2>Quick Start</h2>
                <pre><code class="language-javascript">const JSONDatabase = require('./JSONDatabase');

const db = new JSONDatabase('./my-secure-db.json', {
  // IMPORTANT: Store this key in environment variables, not in code!
  encryptionKey: 'd0a7e8c1b2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9',
});

async function main() {
  await db.set('users.alice', { name: 'Alice', age: 30, tags: ['active'] });
  const alice = await db.get('users.alice');
  console.log(alice); // -> { name: 'Alice', age: 30, tags: ['active'] }

  await db.transaction(data => {
    data.users.alice.age++;
    return data;
  });
  
  console.log(await db.get('users.alice.age')); // -> 31
  await db.close();
}
main();
</code></pre>
            </section>
            
            <section id="api-reference">
                <h2>API Reference</h2>

                <div class="api-method"><div class="api-header"><h4>new JSONDatabase(filename, [options])</h4></div><div class="api-body">
                    <p>Creates a new database instance.</p>
                </div></div>

                <div class="api-method"><div class="api-header"><h4>.get(path, [defaultValue])</h4></div><div class="api-body">
                    <p>Retrieves a value from the database using a lodash path. Returns the default value if the path does not exist.</p>
                    <pre><code class="language-javascript">const theme = await db.get('config.theme', 'light');</code></pre>
                </div></div>

                <div class="api-method"><div class="api-header"><h4>.set(path, value)</h4></div><div class="api-body">
                    <p>Atomically sets or replaces a value at a specific path.</p>
                    <pre><code class="language-javascript">await db.set('users.bob', { name: 'Bob', age: 40 });</code></pre>
                </div></div>
                
                <div class="api-method"><div class="api-header"><h4>.has(path)</h4></div><div class="api-body">
                    <p>Checks if a path exists in the database. Returns true even if the value at the path is `null` or `undefined`.</p>
                    <pre><code class="language-javascript">if (await db.has('users.bob')) {
  console.log('Bob exists!');
}</code></pre>
                </div></div>
                
                <div class="api-method"><div class="api-header"><h4>.delete(path)</h4></div><div class="api-body">
                    <p>Atomically deletes a property at a specified path. Returns `true` if the property existed and was deleted.</p>
                    <pre><code class="language-javascript">const wasDeleted = await db.delete('users.temporary');
if (wasDeleted) console.log('Temporary user cleaned up.');</code></pre>
                </div></div>

                <div class="api-method"><div class="api-header"><h4>.push(path, ...items)</h4></div><div class="api-body">
                    <p>Pushes one or more unique items into an array at a given path. Creates the array if it doesn't exist. Uses deep comparison for uniqueness.</p>
                    <pre><code class="language-javascript">await db.push('users.alice.tags', 'verified', 'premium');</code></pre>
                </div></div>

                <div class="api-method"><div class="api-header"><h4>.pull(path, ...itemsToRemove)</h4></div><div class="api-body">
                    <p>Removes one or more items from an array at a given path. Uses deep comparison to find items to remove.</p>
                    <pre><code class="language-javascript">await db.pull('users.alice.tags', 'active');</code></pre>
                </div></div>

                <div class="api-method"><div class="api-header"><h4>.transaction(asyncFn)</h4></div><div class="api-body">
                    <p>Performs a complex, multi-step operation atomically. The provided function receives a deep clone of the data and MUST return the modified data object.</p>
                    <pre><code class="language-javascript">await db.transaction(async (data) => {
  data.users.alice.logins = (data.users.alice.logins || 0) + 1;
  data.users.alice.lastLogin = Date.now();
  return data; // IMPORTANT: must return the data
});</code></pre>
                </div></div>

                <div class="api-method"><div class="api-header"><h4>.batch(ops, [options])</h4></div><div class="api-body">
                    <p>Executes multiple simple operations atomically in a single disk write for high performance.</p>
                    <pre><code class="language-javascript">await db.batch([
  { type: 'set', path: 'users.jane', value: { age: 30 } },
  { type: 'push', path: 'users.jane.hobbies', values: ['reading'] },
  { type: 'delete', path: 'users.oldUser' }
]);</code></pre>
                </div></div>
                
                <div class="api-method"><div class="api-header"><h4>.find(collectionPath, predicate)</h4></div><div class="api-body">
                    <p>Finds the first entry in a collection (an object or array) that satisfies the predicate function.</p>
                    <pre><code class="language-javascript">const adminUser = await db.find('users', (user, key) => {
  return user.tags.includes('admin');
});</code></pre>
                </div></div>

                <div class="api-method"><div class="api-header"><h4>.findByIndex(indexName, value)</h4></div><div class="api-body">
                    <p>Instantly finds an object in a collection using a pre-configured index. This is the fastest way to look up data.</p>
                    <h5>Requires setup in constructor:</h5>
                    <pre><code class="language-javascript">const db = new JSONDatabase('db', {
  indices: [{ name: 'user-email', path: 'users', field: 'email', unique: true }]
});

// Later...
const user = await db.findByIndex('user-email', 'alice@example.com');</code></pre>
                </div></div>

                <div class="api-method"><div class="api-header"><h4>.clear()</h4></div><div class="api-body">
                    <p>Clears the entire database content, replacing it with an empty object (`{}`). Use with caution!</p>
                    <pre><code class="language-javascript">await db.clear();
console.log('Database has been reset.');</code></pre>
                </div></div>

                <div class="api-method"><div class="api-header"><h4>.getStats()</h4></div><div class="api-body">
                    <p>Returns a synchronous object containing operational statistics for the database instance.</p>
                    <pre><code class="language-javascript">const stats = db.getStats();
console.log(`DB writes: ${stats.writes}, DB reads: ${stats.reads}`);</code></pre>
                </div></div>

                <div class="api-method"><div class="api-header"><h4>.close()</h4></div><div class="api-body">
                    <p>Waits for any pending write operations to complete, then closes the database instance. Call this for a graceful shutdown.</p>
                    <pre><code class="language-javascript">await db.close();
console.log('Database connection closed safely.');</code></pre>
                </div></div>
            </section>
        </main>
        
        <footer class="footer">
            <p>Released under the MIT License.</p>
            <p>Crafted for simplicity and security.</p>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
</body>
</html>